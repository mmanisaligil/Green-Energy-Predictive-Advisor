<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <title>Predictive Energy Audit – Enerji İkizi</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
</head>
<body>
  <div class="app">
    <header class="app-header">
      <div>
        <h1>Predictive Energy Audit</h1>
        <p class="subtitle">
          Belirsiz yaşam tarzından → net tüketim bandı ve uygun EcoFlow çözümüne
        </p>
      </div>
      <button class="btn btn-secondary" onclick="location.href='{{ url_for('landing') }}'">
        ← Ana Sayfa
      </button>
    </header>

    <!-- STEP 0: Ana seçim (main menu korunuyor) -->
    <section class="card">
      <h2>Nasıl başlamak istersin?</h2>
      <div class="landing-options">
        <button id="btnModePremade" class="btn btn-secondary">
          EcoFlow Hazır Paketler
          <span class="btn-caption">Hazır senaryoları ve paketleri gez</span>
        </button>
        <button id="btnModeCustom" class="btn btn-primary">
          Kendi Enerji İkizimi Tasarlıyorum
          <span class="btn-caption">Evin için tahmini tüketim bandı çıkar</span>
        </button>
      </div>
    </section>

    <!-- BRANCH A: Pre-made EcoFlow packs -->
    <section id="premadeSection" class="card hidden">
      <div class="section-header">
        <h2>EcoFlow Hazır Paketler</h2>
        <p>Hayatına benzeyen bir senaryo seç. Her kart, kapsadığı yükleri ve eşleşen EcoFlow seviyesini gösterir.</p>
      </div>
      <div id="premadeGrid" class="grid"></div>
    </section>

    <!-- BRANCH B: Custom design -->
    <section id="customSection" class="card hidden">
      <div class="section-header">
        <h2>Özel Predictive Tasarım</h2>
        <p>Min / tipik / max tüketimini tahmin edip bunu EcoFlow sistemlerine ve güneşe bağlayacağız.</p>
      </div>

      <!-- Step 1: Archetype selection -->
      <div class="step">
        <div class="step-header">
          <span class="step-number">1</span>
          <h3>Ev arketipi ve temel yük</h3>
        </div>
        <div class="step-body">
          <label class="field">
            <span class="field-label">Ev arketipi</span>
            <select id="archetypeSelect"></select>
          </label>
          <label class="checkbox">
            <input type="checkbox" id="expertMode" />
            <span>Uzman modu (arketip temel yükünü sıfırla, her şeyi paketlerle tanımlarım)</span>
          </label>
          <p class="hint">
            Arketip; ev tipin ve büyüklüğüne göre “her zaman açık” baz yükü (buzdolabı, modem, standby, tipik aydınlatma)
            tahmin eder. Uzman modu bu baz yükü sıfırlar.
          </p>
        </div>
      </div>

      <!-- Step 2: Load packs -->
      <div class="step">
        <div class="step-header">
          <span class="step-number">2</span>
          <h3>Yaşam tarzı yük paketleri ekle</h3>
        </div>
        <div class="step-body">
          <div class="tabs">
            <button class="tab active" data-pack-group="ac1p">AC 1-Faz Konut</button>
            <button class="tab" data-pack-group="ac3p">AC 3-Faz / Endüstri</button>
            <button class="tab" data-pack-group="dc12">DC 12 V</button>
            <button class="tab" data-pack-group="dc24">DC 24 V</button>
            <button class="tab" data-pack-group="dc48">DC 48 V</button>
          </div>
          <div id="packList" class="pack-list"></div>

          <h4>Seçili paketler</h4>
          <div id="selectedPacksEmpty" class="empty-state">
            Henüz paket yok. Yukarıdan herhangi bir pakete “+ Ekle” diyerek enerji ikizine dahil et.
          </div>
          <table id="selectedPacksTable" class="table hidden">
            <thead>
              <tr>
                <th>Paket</th>
                <th>Grup</th>
                <th>Kullanım</th>
                <th>Kaldır</th>
              </tr>
            </thead>
            <tbody id="selectedPacksBody"></tbody>
          </table>
          <p class="hint">
            “Kullanım” slider’ı, paket içindeki min / tipik / max günlük kullanım bandına karşılık gelir.
          </p>
        </div>
      </div>

      <!-- Step 3: Solar configuration -->
      <div class="step">
        <div class="step-header">
          <span class="step-number">3</span>
          <h3>Sisteme güneş ekle</h3>
        </div>
        <div class="step-body">
          <label class="field">
            <span class="field-label">Şehir (güneşlenme için)</span>
            <select id="citySelect"></select>
          </label>

          <div class="field">
            <span class="field-label">Solar konfigürasyon</span>
            <div class="solar-options">
              <button class="btn btn-chip" data-solar-preset="400">2 × 200 W (400 W)</button>
              <button class="btn btn-chip" data-solar-preset="1600">4 × 400 W (1.6 kW)</button>
              <button class="btn btn-chip" data-solar-preset="6400">8 × 800 W (6.4 kW)</button>
            </div>
            <div class="custom-solar">
              <label>
                veya özel toplam PV gücü:
                <input type="number" id="solarWpInput" min="0" step="50" placeholder="örn. 2000" /> W
              </label>
            </div>
          </div>

          <button id="btnSimulate" class="btn btn-primary btn-full">
            Tüketim, güneş, tasarruf ve EcoFlow önerisini simüle et
          </button>
        </div>
      </div>
    </section>

    <!-- Results -->
    <section id="resultsSection" class="card hidden">
      <div class="section-header">
        <h2>Simülasyon Sonuçları</h2>
        <p>
          Bu bir tahmin bandıdır, sahte hassasiyet değil. Min / tipik / max, girdi belirsizliğini yansıtır.
        </p>
      </div>

      <div class="results-grid">
        <div class="result-card">
          <h3>Günlük tüketim</h3>
          <p class="result-main" id="consumptionSummary"></p>
          <ul class="result-list">
            <li id="consumptionMin"></li>
            <li id="consumptionAvg"></li>
            <li id="consumptionMax"></li>
          </ul>
          <p class="hint" id="peakSummary"></p>
        </div>

        <div class="result-card">
          <h3>Solar üretim (ortalama)</h3>
          <p class="result-main" id="solarSummary"></p>
          <ul class="result-list">
            <li id="solarSummer"></li>
            <li id="solarWinter"></li>
          </ul>
        </div>

        <div class="result-card">
          <h3>Fatura &amp; CO₂ etkisi</h3>
          <p class="result-main" id="savingsSummary"></p>
          <ul class="result-list">
            <li id="savingsYear1"></li>
            <li id="savingsYear5"></li>
            <li id="co2Summary"></li>
          </ul>
        </div>

        <div class="result-card">
          <h3>Önerilen EcoFlow seviyesi</h3>
          <p class="result-main" id="tierTitle"></p>
          <p id="tierUsage"></p>
          <ul class="result-list" id="tierDetails"></ul>
          <p class="hint">
            Seviye, tipik tüketim bandını ve pik gücü güvenlik payıyla karşılayacak şekilde seçilir.
          </p>
        </div>
      </div>
    </section>
  </div>

  <script src="{{ url_for('static', filename='app.js') }}"></script>
</body>
</html>
